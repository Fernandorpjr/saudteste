<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flor - Recepcionista Virtual USF Apipucos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
            color: #334155;
        }

        .container {
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.08),
                0 8px 32px rgba(0, 0, 0, 0.06),
                0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 0;
            max-width: 900px;
            width: 100%;
            overflow: hidden;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .header {
            background: linear-gradient(135deg, #1e40af 0%, #1d4ed8 50%, #2563eb 100%);
            color: white;
            padding: 32px 40px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 20px rgba(30, 64, 175, 0.15);
        }

        .logo-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 15px;
        }

        .logo-container {
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo-placeholder {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .logo-placeholder:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .logo-placeholder.has-logo {
            border: 2px solid rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.1);
        }

        .logo-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 6px;
        }

        .logo-upload {
            display: none;
        }

        .logo-label {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
        }

        .avatar {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 45px;
            animation: gentlePulse 3s ease-in-out infinite alternate;
            box-shadow: 
                0 8px 32px rgba(251, 191, 36, 0.3),
                0 4px 16px rgba(245, 158, 11, 0.2);
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes gentlePulse {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.03) rotate(1deg); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 12px;
            font-weight: 600;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            opacity: 0.95;
            font-size: 1.15em;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .status {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-content {
            flex: 1;
            position: relative;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            animation: blink 1.5s ease-in-out infinite alternate;
        }

        .status-indicator.listening {
            background: #ef4444;
            animation: fastBlink 0.5s ease-in-out infinite alternate;
        }

        @keyframes blink {
            0% { opacity: 1; }
            100% { opacity: 0.3; }
        }

        @keyframes fastBlink {
            0% { opacity: 1; }
            100% { opacity: 0.1; }
        }

        .chat-container {
            padding: 32px 40px;
            background: #fafafa;
            min-height: 500px;
        }

        .messages {
            height: 420px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            background: #ffffff;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.02);
        }

        .message {
            margin-bottom: 20px;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            text-align: right;
        }

        .message.bot {
            text-align: left;
        }

        .message-content {
            display: inline-block;
            max-width: 75%;
            padding: 14px 20px;
            border-radius: 18px;
            font-size: 0.98em;
            line-height: 1.5;
            font-weight: 400;
        }

        .user .message-content {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
        }

        .bot .message-content {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .message-sender {
            font-size: 0.82em;
            margin: 6px 0;
            opacity: 0.7;
            font-weight: 500;
        }

        .input-container {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .input-field {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 28px;
            font-size: 1em;
            outline: none;
            transition: all 0.3s ease;
            background: #ffffff;
            font-weight: 400;
        }

        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .input-field::placeholder {
            color: #94a3b8;
        }

        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 28px;
            font-size: 0.98em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 140px;
            justify-content: center;
            letter-spacing: 0.01em;
        }

        .btn-send {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-voice {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-voice.listening {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            animation: gentlePulse 2s ease-in-out infinite;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .welcome-message {
            text-align: center;
            color: #64748b;
            font-style: normal;
            padding: 24px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 16px;
            margin-bottom: 24px;
            border: 1px solid #bae6fd;
            font-weight: 400;
        }

        .welcome-message p {
            margin-bottom: 8px;
        }

        .welcome-message strong {
            color: #1e40af;
            font-weight: 600;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            color: #64748b;
            font-style: italic;
            font-weight: 400;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: #64748b;
            animation: typingDots 1.6s ease-in-out infinite;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDots {
            0%, 60%, 100% { 
                transform: translateY(0); 
                opacity: 0.4;
            }
            30% { 
                transform: translateY(-8px); 
                opacity: 1;
            }
        }

        .quick-questions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .quick-question {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-weight: 500;
            color: #475569;
        }

        .quick-question:hover {
            background: #f8fafc;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: #cbd5e1;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                margin: 0;
                border-radius: 20px;
                max-width: 100%;
            }
            
            .header {
                padding: 24px 20px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .avatar {
                width: 75px;
                height: 75px;
                font-size: 38px;
            }
            
            .logo-section {
                flex-direction: column;
                gap: 15px;
            }
            
            .logo-container {
                order: 3;
            }
            
            .header-content {
                order: 1;
            }
            
            .chat-container {
                padding: 20px;
            }
            
            .messages {
                height: 350px;
                padding: 20px;
            }
            
            .input-container {
                flex-direction: column;
                gap: 12px;
            }
            
            .btn {
                width: 100%;
                padding: 14px 20px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .quick-questions {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 10px;
            }
            
            .quick-question {
                padding: 12px 14px;
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo-container">
                    <div class="logo-placeholder" id="mainLogo" onclick="document.getElementById('mainLogoInput').click()">
                        <span>🏥</span>
                    </div>
                    <input type="file" id="mainLogoInput" class="logo-upload" accept="image/*" onchange="handleLogoUpload(this, 'mainLogo')">
                    <div class="logo-label">Logo USF</div>
                </div>
                <div class="header-content">
                    <div class="status">
                        <div class="status-indicator" id="statusIndicator"></div>
                        <span id="statusText">Online</span>
                    </div>
                    <div class="avatar">🌸</div>
                    <h1>Flor</h1>
                    <p>Recepcionista Virtual - USF Apipucos</p>
                </div>
                <div class="logo-container">
                    <div class="logo-placeholder" id="secondaryLogo" onclick="document.getElementById('secondaryLogoInput').click()">
                        <span>🏛️</span>
                    </div>
                    <input type="file" id="secondaryLogoInput" class="logo-upload" accept="image/*" onchange="handleLogoUpload(this, 'secondaryLogo')">
                    <div class="logo-label">Logo Prefeitura</div>
                </div>
            </div>
        </div>
        
        <div class="chat-container">
            <div class="welcome-message">
                <p>👋 <strong>Bem-vindo(a) à USF Apipucos!</strong></p>
                <p>Eu sou a <strong>Flor</strong>, sua assistente virtual. Estou aqui para orientá-lo(a) com carinho sobre nossos serviços de saúde.</p>
                <p>💬 Digite sua pergunta abaixo ou diga <strong>"Oi Flor"</strong> para conversar comigo por voz!</p>
                <p style="font-size: 0.9em; margin-top: 12px; opacity: 0.8;">🕒 Atendimento 24h • 🏥 SUS • 🌸 Atendimento Humanizado</p>
            </div>
            
            <div class="quick-questions">
                <div class="quick-question" onclick="askQuestion('Qual é o endereço da USF?')">📍 Endereço</div>
                <div class="quick-question" onclick="askQuestion('Qual é o telefone?')">📞 Telefone</div>
                <div class="quick-question" onclick="askQuestion('Qual é o horário de funcionamento?')">⏰ Horário</div>
                <div class="quick-question" onclick="askQuestion('Que serviços vocês oferecem?')">🏥 Serviços</div>
                <div class="quick-question" onclick="askQuestion('Quais são os médicos?')">👨‍⚕️ Médicos</div>
                <div class="quick-question" onclick="askQuestion('Quais são os agentes de saúde?')">👥 Agentes</div>
                <div class="quick-question" onclick="askQuestion('Onde é a vacina?')">💉 Local Vacina</div>
                <div class="quick-question" onclick="askQuestion('Tem dentista?')">🦷 Dentista</div>
                <div class="quick-question" onclick="askQuestion('O que é o SUS?')">🏥 SUS</div>
                <div class="quick-question" onclick="askQuestion('O que é o SISREG?')">📊 SISREG</div>
                <div class="quick-question" onclick="askQuestion('O que é hipertensão?')">❤️ Pressão</div>
                <div class="quick-question" onclick="askQuestion('Como agendar consulta?')">📅 Agendamento</div>
            </div>
            
            <div class="messages" id="messages">
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <span>Flor está digitando</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <div class="input-container">
                <input type="text" id="userInput" class="input-field" placeholder="Digite sua pergunta aqui..." onkeypress="handleKeyPress(event)">
                <button class="btn btn-send" onclick="sendMessage()">
                    <span>📤</span>
                    Enviar
                </button>
            </div>
            
            <div class="controls">
                <button class="btn btn-voice" id="voiceBtn" onclick="toggleVoiceRecognition()">
                    <span id="voiceIcon">🎤</span>
                    <span id="voiceText">Ativar Voz</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variáveis globais
        let recognition = null;
        let isListening = false;
        let continuousListening = false;
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;

        // Base de conhecimento da USF Apipucos
        const knowledge = {
            // Informações básicas
            endereco: "Rua Professor José de Barros, 123, Apipucos, Recife - PE",
            telefone: "(81) 99999-9999",
            email: "usf.apipucos@recife.pe.gov.br",
            horario: "Segunda a sexta-feira, das 7h às 17h",
            
            // Equipes por dia
            equipes: {
                segunda: "Dr. Felipe Jacobovitz (Clínico Geral), Dr. Carmem Verônica, Dr. Clariana Falcão, Ag. Doca (Manhã) / Dr. Marcos Augusto (Clínico Geral), Dr. Thácia Bezerra, Dr. Loala, Ag. Maria Silva (Tarde)",
                terca: "Dr. Rubens Cavalcanti (Pediatria), Dr. Sabrynna Mayara, Dr. Sânia, Ag. João Pereira (Manhã) / Dr. Felipe Jacobovitz (Clínico Geral), Dr. Carmem Verônica, Dr. Clariana Falcão, Ag. Ana Costa (Tarde)",
                quarta: "Dr. Marcos Augusto (Clínico Geral), Dr. Thácia Bezerra, Dr. Loala, Ag. Paulo Souza (Manhã) / Dr. Felipe Jacobovitz (Clínico Geral), Dr. Carmem Verônica, Dr. Clariana Falcão, Ag. Maria Silva (Tarde)",
                quinta: "Dr. Felipe Jacobovitz (Clínico Geral), Dr. Carmem Verônica, Dr. Clariana Falcão, Ag. Ana Costa (Manhã) / Dr. Marcos Augusto (Clínico Geral), Dr. Thácia Bezerra, Dr. Loala, Ag. Maria Silva (Tarde)",
                sexta: "Dr. Rubens Cavalcanti (Pediatria), Dr. Sabrynna Mayara, Dr. Sânia, Ag. João Pereira (Manhã) / Dr. Marcos Augusto (Clínico Geral), Dr. Thácia Bezerra, Dr. Loala, Ag. Paulo Souza (Tarde)"
            },
            
            // Médicos por turno
            medicos: {
                primeiro: "Dr. Felipe Jacobovitz (8h às 12h), Dr. Rubens Cavalcanti (8h às 12h), Dr. Marcos Augusto (8h às 12h)",
                segundo: "Dr. Marcos Augusto (13h às 17h), Dr. Felipe Jacobovitz (13h às 17h)"
            },
            
            // Serviços
            servicos: [
                "Atenção primária à saúde",
                "Consultas médicas (clínico geral e pediatria)",
                "Imunização (vacinas)",
                "Coleta de material biológico (exames)",
                "Pré-natal",
                "Saúde da família",
                "Eletrocardiograma",
                "Medição de pressão arterial",
                "Teste de glicemia"
            ],
            
            // Exames
            exames: {
                horario: "Terça e quinta-feira, das 7h às 11h",
                tipos: ["Exames de sangue (jejum de 12h)", "Exames de urina", "Eletrocardiograma", "Medição de pressão arterial", "Teste de glicemia"],
                documentos: "Pedido médico e documento de identidade"
            },
            
            // Vacinação
            vacinacao: {
                dias: "Quarta e quinta-feira, das 10h às 16h",
                tipos: ["Vacinas de rotina (crianças e adultos)", "Vacina da gripe", "Vacina COVID-19", "Vacina HPV (adolescentes)"],
                documentos: "Cartão de vacina e documento de identidade"
            },
            
            // Agendamento
            agendamento: {
                como: "Por telefone (81) 99999-9999 ou presencialmente na recepção",
                horario: "7h às 16h",
                documentos: "CPF, RG, Cartão SUS",
                chegada: "15 minutos de antecedência"
            },
            
            // Informações específicas da equipe
            equipeEspecifica: {
                clariana: "Dra. Clariana está todas as quartas-feiras à tarde para fazer prevenção. Você pode vir por ordem de chegada ou agendamento.",
                jorge: "Quem faz o regulamento é o senhor Jorge, gente muito boa e educada.",
                wellington: "O vigia é o Wellington, ele apoia mais do que vigia.",
                rubens: "O médico da manhã é Dr. Rubens. Ele atende por ordem de chegada.",
                fernando: "Fernando Rocha está aprendendo recepção e eu estou ajudando ele.",
                niedja: "A gestora é Niedja.",
                carmem: "Para vacina e coleta de sangue, vá na primeira porta à direita e fale com Dra. Carmen.",
                loala: "Para atendimento dentista, tem que ser agendamento com a Dra. e cirurgiã dentista Loala.",
                marcos: "O clínico geral da tarde é Dr. Marcos Augusto. O agendamento tem que ser com agente de saúde ou por ordem de chegada.",
                bruno: "O diretor do terceiro distrito é Bruno de Luna.",
                joao: "O prefeito do Recife é João Campos.",
                residentes: "Os médicos residentes são Dra. Sabrina e Dr. Felipe."
            },
            
            // Agentes de saúde para acolhimento na sede
            agentesAcolhimento: {
                geral: "O acolhimento é feito pelo agente de saúde.",
                segunda: "Na segunda-feira, o agente Doca fica na sede para acolhimento.",
                terca: "Na terça-feira, o agente João Pereira fica na sede para acolhimento.",
                quarta: "Na quarta-feira, o agente Paulo Souza fica na sede para acolhimento.",
                quinta: "Na quinta-feira, a agente Ana Costa fica na sede para acolhimento.",
                sexta: "Na sexta-feira, a agente Maria Silva fica na sede para acolhimento.",
                sandra: "Sandra é uma agente de saúde.",
                debora: "Débora é uma agente de saúde.",
                richard: "Richard é um agente de saúde.",
                doca: "Doca é uma agente de saúde."
            },
            
            // Informações sobre o SUS
            sus: {
                definicao: "O SUS é o Sistema Único de Saúde, criado para garantir o acesso gratuito e universal à saúde no Brasil.",
                criacao: "O SUS foi criado em 1988 pela Constituição Federal.",
                objetivo: "Oferecer atendimento integral, universal e gratuito à população brasileira.",
                principios: "Os princípios do SUS são: universalidade, integralidade e equidade.",
                acesso: "Todos os cidadãos brasileiros têm direito ao SUS.",
                atencaoPrimaria: "A Atenção Primária é a porta de entrada do SUS, que cuida da prevenção e acompanhamento da saúde.",
                usf: "USF significa Unidade de Saúde da Família, um serviço básico do SUS que atende a população local.",
                financiamento: "O SUS é financiado por recursos públicos das esferas federal, estadual e municipal.",
                servicos: "O SUS oferece atendimento básico, exames, consultas, emergências, cirurgias, entre outros.",
                vacinacao: "Sim, o SUS é responsável pela vacinação em todo o Brasil.",
                doencasCronicas: "Sim, o acompanhamento de doenças crônicas faz parte do SUS.",
                profissionais: "Os profissionais da USF são responsáveis pela promoção, prevenção e tratamento básico de saúde.",
                gratuito: "Sim, todos os serviços do SUS são gratuitos para a população.",
                atendimento: "As equipes da USF fazem atendimentos na unidade e na residência dos pacientes.",
                integralidade: "Integralidade no SUS é a oferta de serviços que consideram a pessoa em todas as suas necessidades."
            },
            
            // Informações sobre SISREG
            sisreg: {
                definicao: "O SISREG é um sistema web criado pelo Ministério da Saúde para gerenciar a regulação do acesso a consultas, exames e procedimentos na rede pública de saúde, otimizando recursos e organizando o fluxo de atendimento com muito cuidado.",
                modulos: "O SISREG possui dois módulos principais: o módulo Ambulatorial, que regula consultas, exames e Serviços Auxiliares de Diagnóstico e Terapia, e o módulo Hospitalar, que regula internações hospitalares.",
                funcao: "O sistema controla o agendamento e a lista de espera, gerenciando a oferta e demanda dos serviços de saúde, garantindo organização e priorização dos pacientes conforme a necessidade clínica, sempre com atenção ao bem-estar de cada pessoa.",
                usuarios: "O SISREG é utilizado por profissionais da saúde, gestores e operadores das Centrais de Regulação, que são treinados e cadastrados para manter o sistema atualizado e funcionando com eficiência para melhor atender você.",
                obrigatoriedade: "O uso do SISREG é gratuito e oficial para a regulação no SUS, mas sua implantação depende de adesão formal dos gestores municipais ou estaduais de saúde."
            },
            
            // Informações sobre USF Apipucos
            usfApipucos: {
                definicao: "A USF Apipucos é uma unidade básica de saúde que faz parte da Atenção Primária do SUS no bairro Apipucos.",
                funcao: "Promover a saúde, prevenir doenças e acompanhar os pacientes da comunidade.",
                profissionais: "Na USF Apipucos atuam médicos, enfermeiros, dentistas, agentes comunitários e outros profissionais da saúde.",
                gestantes: "Sim, a USF Apipucos acompanha o pré-natal e cuidados durante a gestação.",
                faixasEtarias: "Sim, oferece cuidado especial para todas as faixas etárias, crianças e idosos.",
                vacinacao: "Sim, a USF Apipucos é um dos locais de vacinação da comunidade.",
                contribuicao: "A USF Apipucos contribui atendendo a população local com ações preventivas e tratamentos básicos.",
                acoes: "Realizamos consultas, vacinação, pré-natal, acompanhamento de diabetes e hipertensão.",
                agente: "O agente comunitário de saúde visita as famílias e faz encaminhamentos para a equipe da unidade.",
                pandemia: "A USF Apipucos ajuda realizando testes, orientações e acompanhamento dos casos.",
                educacao: "Sim, promovemos palestras e atividades educativas para a comunidade.",
                bairro: "Sim, Apipucos é um bairro histórico de Recife, com raízes indígenas, coloniais e desenvolvimento industrial.",
                importancia: "O SUS é fundamental porque leva saúde pública e atendimento básico humanizado para toda a população."
            },
            
            // Informações de saúde e doenças
            saude: {
                hipertensao: "A hipertensão é quando a pressão do sangue fica alta, e cuidar dela ajuda seu coração a ficar forte e saudável.",
                prevencaoHipertensao: "Comer saudável, praticar exercícios e evitar o excesso de sal fazem um ótimo trabalho para manter sua pressão equilibrada.",
                diabetes: "Diabetes é quando o corpo tem dificuldade em usar o açúcar do sangue, mas com cuidados e acompanhamento, você pode viver bem.",
                sintomasDiabetes: "Fique atento a muita sede, fome e vontade de urinar. Se perceber isso, procure nossa ajuda.",
                controleDiabetes: "Com alimentação especial, atividade física e seguindo orientações médicas, você vai se cuidar muito bem.",
                asma: "A asma é uma condição que pode deixar a respiração mais difícil, mas com tratamento certo você pode levar uma vida tranquila.",
                criseAsma: "Respire devagar, use seu medicamento e, se precisar, venha rápido à nossa unidade.",
                lombalgia: "A lombalgia pode vir do esforço, postura ou estresse, mas temos jeitos gentis de aliviar sua dor.",
                dorCostas: "Alongamento, exercícios e repouso ajudam bastante, e aqui ensinamos tudo com carinho.",
                tuberculose: "É uma infecção que afeta os pulmões, mas com tratamento correto na USF você ficará bem rapidinho.",
                prevencaoTuberculose: "Vacinação e evitar contato com pessoas doentes ajudam muito.",
                hanseniase: "É uma doença que precisa de tratamento especial, que fornecemos na USF.",
                detectarHanseniase: "Manchas na pele e sensibilidade diferente são sinais importantes que avaliamos com cuidado.",
                infeccaoUrinaria: "É quando o xixi incomoda, mas com remédio e hidratação você melhora rapidinho.",
                evitarInfeccaoUrinaria: "Beber água, ir ao banheiro quando sentir vontade e higiene são gestos simples que ajudam.",
                vacinas: "Muitas vacinas importantes para você e sua família estão disponíveis aqui.",
                saudeMental: "Aqui você tem um espaço seguro para conversar e receber apoio com muita gentileza.",
                colesterol: "O colesterol controlado ajuda seu coração a funcionar melhor, prevenindo doenças.",
                dengue: "Dengue é uma doença transmitida por mosquitos, prevenimos mantendo água limpa e evitando focos.",
                febre: "Se a febre aparecer, descanse bastante e, se precisar, venha até a USF.",
                dorGarganta: "Se a dor não passar em alguns dias ou vier com febre, nossa equipe está aqui para ajudar.",
                ferimentos: "Aqui ensinamos como cuidar com carinho, e realizamos curativos para sua segurança.",
                diabetesGestacional: "É uma forma de diabetes que pode aparecer na gravidez, monitoramos para mamãe e bebê ficarem saudáveis.",
                pararFumar: "Temos programas especiais para ajudar você a conquistar uma vida mais saudável.",
                agendamento: "É fácil e rápido! Você pode ligar ou vir até aqui, estamos prontos para atender.",
                atividadeFisica: "Movimentar-se deixa o corpo forte e a mente feliz, incentivamos você com carinho.",
                dst: "Usar preservativo e fazer exames regulares são cuidados importantes para sua saúde íntima.",
                prenatal: "O pré-natal cuida da saúde da mamãe e do bebê, garantindo uma gravidez tranquila.",
                exames: "Muitos exames básicos para cuidar da sua saúde estão disponíveis aqui.",
                gravidez: "Estamos aqui para acolher você e realizar o teste rápido, cuidando com muito carinho.",
                alimentacao: "Comer alimentos variados e coloridos ajuda seu corpo a ficar forte.",
                saudeBucal: "Cuidar dos dentes e gengivas é essencial, temos profissionais para seu sorriso ficar saudável.",
                ansiedade: "Entendemos seu sentimento e aqui temos acolhimento especial para ouvir você.",
                medicamentos: "Nossa equipe explica tudo com paciência para que você use os remédios da melhor forma.",
                quedas: "Deixar o ambiente organizado e com boa iluminação ajuda a evitar acidentes.",
                receberRemedio: "Após a consulta, entregamos os medicamentos indicados, com todo cuidado.",
                cancerColo: "É um tipo de câncer prevenível com exames regulares, fazemos esse acompanhamento.",
                papanicolau: "É um exame simples e rápido, feito aqui com muito respeito e cuidado.",
                depressao: "Depressão é quando a tristeza fica prolongada, mas com ajuda e tratamento podemos melhorar sua qualidade de vida.",
                emergencias: "Cuidamos de pequenas urgências com atenção e, se precisar, encaminhamos para o serviço adequado."
            }
        };

        // Função para inicializar o reconhecimento de voz
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'pt-BR';
                recognition.continuous = true;
                recognition.interimResults = false;
                
                recognition.onstart = function() {
                    updateStatus('listening', 'Ouvindo...');
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
                    
                    // Verifica se foi dito "oi flor" para ativar
                    if (transcript.includes('oi flor') || transcript.includes('olá flor')) {
                        speak("Oi! Como posso ajudá-lo hoje? Estou aqui para orientá-lo com todo carinho sobre nossos serviços.");
                        addMessage('Flor', 'Oi! Como posso ajudá-lo hoje? Estou aqui para orientá-lo com todo carinho sobre nossos serviços.', 'bot');
                        return;
                    }
                    
                    // Se está no modo de escuta contínua, processa a pergunta
                    if (continuousListening || transcript.includes('oi flor')) {
                        addMessage('Você', transcript, 'user');
                        const response = processQuestion(transcript);
                        setTimeout(() => {
                            addMessage('Flor', response, 'bot');
                            speak(response);
                        }, 500);
                    }
                };
                
                recognition.onerror = function(event) {
                    console.error('Erro no reconhecimento de voz:', event.error);
                    updateStatus('online', 'Online');
                };
                
                recognition.onend = function() {
                    if (continuousListening) {
                        recognition.start();
                    } else {
                        updateStatus('online', 'Online');
                        updateVoiceButton(false);
                    }
                };
            }
        }

        // Função para processar perguntas e gerar respostas
        function processQuestion(question) {
            const q = question.toLowerCase();
            
            // Saudações
            if (q.includes('oi') || q.includes('olá') || q.includes('bom dia') || q.includes('boa tarde') || q.includes('boa noite')) {
                return "Olá! Seja muito bem-vindo(a) à USF Apipucos! Eu sou a Flor, sua assistente virtual. Estou aqui para orientá-lo(a) com carinho sobre nossos serviços de saúde. Como posso ajudá-lo(a) hoje?";
            }
            
            // Agradecimentos
            if (q.includes('obrigad') || q.includes('valeu') || q.includes('tchau') || q.includes('até logo')) {
                return "De nada! Foi um prazer ajudá-lo. Tenha um ótimo dia e cuide-se bem!";
            }
            
            // Informações específicas da equipe
            if (q.includes('clariana') || q.includes('dra clariana') || q.includes('doutora clariana')) {
                return knowledge.equipeEspecifica.clariana;
            }
            
            if (q.includes('prevenção') || q.includes('preventivo')) {
                return knowledge.equipeEspecifica.clariana;
            }
            
            if (q.includes('regulamento') || q.includes('quem faz regulamento') || q.includes('jorge')) {
                return knowledge.equipeEspecifica.jorge;
            }
            
            if (q.includes('vigia') || q.includes('segurança') || q.includes('wellington')) {
                return knowledge.equipeEspecifica.wellington;
            }
            
            if (q.includes('médico da manhã') || q.includes('médico de manhã') || q.includes('rubens') || q.includes('dr rubens')) {
                return knowledge.equipeEspecifica.rubens;
            }
            
            // Agentes de saúde para acolhimento
            if (q.includes('agente') || q.includes('acolhimento') || q.includes('agente de saúde')) {
                if (q.includes('segunda') || q.includes('segunda-feira')) {
                    return knowledge.agentesAcolhimento.segunda;
                } else if (q.includes('terça') || q.includes('terça-feira')) {
                    return knowledge.agentesAcolhimento.terca;
                } else if (q.includes('quarta') || q.includes('quarta-feira')) {
                    return knowledge.agentesAcolhimento.quarta;
                } else if (q.includes('quinta') || q.includes('quinta-feira')) {
                    return knowledge.agentesAcolhimento.quinta;
                } else if (q.includes('sexta') || q.includes('sexta-feira')) {
                    return knowledge.agentesAcolhimento.sexta;
                } else if (q.includes('quem faz') || q.includes('quem é responsável')) {
                    return knowledge.agentesAcolhimento.geral;
                } else {
                    return `${knowledge.agentesAcolhimento.geral} Temos agentes todos os dias: Segunda: Doca, Terça: João Pereira, Quarta: Paulo Souza, Quinta: Ana Costa, Sexta: Maria Silva.`;
                }
            }
            
            // Nomes específicos dos agentes
            if (q.includes('doca')) {
                return knowledge.agentesAcolhimento.segunda;
            }
            if (q.includes('joão pereira') || q.includes('joao pereira')) {
                return knowledge.agentesAcolhimento.terca;
            }
            if (q.includes('paulo souza')) {
                return knowledge.agentesAcolhimento.quarta;
            }
            if (q.includes('ana costa')) {
                return knowledge.agentesAcolhimento.quinta;
            }
            if (q.includes('maria silva')) {
                return knowledge.agentesAcolhimento.sexta;
            }
            
            // Informações sobre pessoas específicas
            if (q.includes('fernando rocha') || q.includes('fernando')) {
                return knowledge.equipeEspecifica.fernando;
            }
            
            if (q.includes('gestora') || q.includes('niedja')) {
                return knowledge.equipeEspecifica.niedja;
            }
            
            // Serviços específicos e localização
            if (q.includes('vacina') && (q.includes('onde') || q.includes('aonde') || q.includes('local'))) {
                return knowledge.equipeEspecifica.carmem;
            }
            
            if (q.includes('coleta de sangue') || q.includes('coleta') && q.includes('sangue')) {
                return knowledge.equipeEspecifica.carmem;
            }
            
            if (q.includes('carmen') || q.includes('dra carmen') || q.includes('doutora carmen')) {
                return knowledge.equipeEspecifica.carmem;
            }
            
            if (q.includes('dentista') || q.includes('atendimento dentista') || q.includes('dental')) {
                return knowledge.equipeEspecifica.loala;
            }
            
            if (q.includes('loala') || q.includes('dra loala') || q.includes('cirurgiã dentista')) {
                return knowledge.equipeEspecifica.loala;
            }
            
            if (q.includes('clínico geral') && (q.includes('tarde') || q.includes('à tarde'))) {
                return knowledge.equipeEspecifica.marcos;
            }
            
            if (q.includes('marcos augusto') || q.includes('dr marcos') || q.includes('marcos')) {
                return knowledge.equipeEspecifica.marcos;
            }
            
            // Perguntas específicas sobre acolhimento
            if (q.includes('quem faz acolhimento') || q.includes('quem é responsável pelo acolhimento')) {
                return knowledge.agentesAcolhimento.geral;
            }
            
            // Agentes de saúde específicos
            if (q.includes('sandra')) {
                return knowledge.agentesAcolhimento.sandra;
            }
            if (q.includes('débora') || q.includes('debora')) {
                return knowledge.agentesAcolhimento.debora;
            }
            if (q.includes('richard')) {
                return knowledge.agentesAcolhimento.richard;
            }
            if (q.includes('doca') && !q.includes('segunda')) {
                return knowledge.agentesAcolhimento.doca;
            }
            
            // Perguntas sobre o SUS
            if (q.includes('o que é o sus') || q.includes('sus') && q.includes('o que é')) {
                return knowledge.sus.definicao;
            }
            if (q.includes('quando o sus foi criado') || q.includes('criação do sus')) {
                return knowledge.sus.criacao;
            }
            if (q.includes('objetivo') && q.includes('sus')) {
                return knowledge.sus.objetivo;
            }
            if (q.includes('princípios') && q.includes('sus')) {
                return knowledge.sus.principios;
            }
            if (q.includes('quem pode ter acesso') && q.includes('sus')) {
                return knowledge.sus.acesso;
            }
            if (q.includes('atenção primária') || q.includes('atencao primaria')) {
                return knowledge.sus.atencaoPrimaria;
            }
            if (q.includes('o que é usf') || q.includes('usf') && q.includes('o que é')) {
                return knowledge.sus.usf;
            }
            if (q.includes('financiado') && q.includes('sus')) {
                return knowledge.sus.financiamento;
            }
            if (q.includes('serviços') && q.includes('sus')) {
                return knowledge.sus.servicos;
            }
            if (q.includes('campanha') && q.includes('vacinação')) {
                return knowledge.sus.vacinacao;
            }
            if (q.includes('doenças crônicas') && q.includes('sus')) {
                return knowledge.sus.doencasCronicas;
            }
            if (q.includes('papel') && q.includes('profissionais')) {
                return knowledge.sus.profissionais;
            }
            if (q.includes('sus é gratuito') || q.includes('gratuito') && q.includes('sus')) {
                return knowledge.sus.gratuito;
            }
            if (q.includes('integralidade') && q.includes('sus')) {
                return knowledge.sus.integralidade;
            }
            
            // Perguntas sobre USF Apipucos
            if (q.includes('o que é a usf apipucos') || q.includes('usf apipucos') && q.includes('o que é')) {
                return knowledge.usfApipucos.definicao;
            }
            if (q.includes('função') && q.includes('usf apipucos')) {
                return knowledge.usfApipucos.funcao;
            }
            if (q.includes('profissionais') && q.includes('usf apipucos')) {
                return knowledge.usfApipucos.profissionais;
            }
            if (q.includes('gestante') && q.includes('usf apipucos')) {
                return knowledge.usfApipucos.gestantes;
            }
            if (q.includes('crianças') && q.includes('idosos')) {
                return knowledge.usfApipucos.faixasEtarias;
            }
            if (q.includes('vacinação') && q.includes('usf apipucos')) {
                return knowledge.usfApipucos.vacinacao;
            }
            if (q.includes('contribui') && q.includes('sus')) {
                return knowledge.usfApipucos.contribuicao;
            }
            if (q.includes('ações de saúde')) {
                return knowledge.usfApipucos.acoes;
            }
            if (q.includes('agente comunitário')) {
                return knowledge.usfApipucos.agente;
            }
            if (q.includes('pandemia')) {
                return knowledge.usfApipucos.pandemia;
            }
            if (q.includes('educação') && q.includes('saúde')) {
                return knowledge.usfApipucos.educacao;
            }
            if (q.includes('bairro apipucos') && q.includes('história')) {
                return knowledge.usfApipucos.bairro;
            }
            
            // Perguntas sobre saúde e doenças
            if (q.includes('hipertensão') && (q.includes('o que é') || q.includes('arterial'))) {
                return knowledge.saude.hipertensao;
            }
            if (q.includes('prevenir') && q.includes('hipertensão')) {
                return knowledge.saude.prevencaoHipertensao;
            }
            if (q.includes('diabetes') && q.includes('o que é')) {
                return knowledge.saude.diabetes;
            }
            if (q.includes('sintomas') && q.includes('diabetes')) {
                return knowledge.saude.sintomasDiabetes;
            }
            if (q.includes('controlar') && q.includes('diabetes')) {
                return knowledge.saude.controleDiabetes;
            }
            if (q.includes('asma') && q.includes('o que é')) {
                return knowledge.saude.asma;
            }
            if (q.includes('crise') && q.includes('asma')) {
                return knowledge.saude.criseAsma;
            }
            if (q.includes('lombalgia') || (q.includes('dor') && q.includes('costas') && q.includes('causas'))) {
                return knowledge.saude.lombalgia;
            }
            if (q.includes('tratar') && q.includes('dor') && q.includes('costas')) {
                return knowledge.saude.dorCostas;
            }
            if (q.includes('tuberculose') && q.includes('o que é')) {
                return knowledge.saude.tuberculose;
            }
            if (q.includes('prevenir') && q.includes('tuberculose')) {
                return knowledge.saude.prevencaoTuberculose;
            }
            if (q.includes('hanseníase') && q.includes('o que é')) {
                return knowledge.saude.hanseniase;
            }
            if (q.includes('detectar') && q.includes('hanseníase')) {
                return knowledge.saude.detectarHanseniase;
            }
            if (q.includes('infecção urinária')) {
                return knowledge.saude.infeccaoUrinaria;
            }
            if (q.includes('evitar') && q.includes('infecção urinária')) {
                return knowledge.saude.evitarInfeccaoUrinaria;
            }
            if (q.includes('vacinas') && (q.includes('posso') || q.includes('tomar'))) {
                return knowledge.saude.vacinas;
            }
            if (q.includes('saúde mental')) {
                return knowledge.saude.saudeMental;
            }
            if (q.includes('colesterol')) {
                return knowledge.saude.colesterol;
            }
            if (q.includes('dengue')) {
                return knowledge.saude.dengue;
            }
            if (q.includes('febre')) {
                return knowledge.saude.febre;
            }
            if (q.includes('dor de garganta')) {
                return knowledge.saude.dorGarganta;
            }
            if (q.includes('ferimentos')) {
                return knowledge.saude.ferimentos;
            }
            if (q.includes('diabetes gestacional')) {
                return knowledge.saude.diabetesGestacional;
            }
            if (q.includes('parar de fumar')) {
                return knowledge.saude.pararFumar;
            }
            if (q.includes('atividade física')) {
                return knowledge.saude.atividadeFisica;
            }
            if (q.includes('doenças sexualmente')) {
                return knowledge.saude.dst;
            }
            if (q.includes('pré-natal')) {
                return knowledge.saude.prenatal;
            }
            if (q.includes('exames') && q.includes('posso fazer')) {
                return knowledge.saude.exames;
            }
            if (q.includes('suspeita') && q.includes('gravidez')) {
                return knowledge.saude.gravidez;
            }
            if (q.includes('alimentação')) {
                return knowledge.saude.alimentacao;
            }
            if (q.includes('saúde bucal')) {
                return knowledge.saude.saudeBucal;
            }
            if (q.includes('ansiedade')) {
                return knowledge.saude.ansiedade;
            }
            if (q.includes('medicamentos') && q.includes('dúvidas')) {
                return knowledge.saude.medicamentos;
            }
            if (q.includes('quedas')) {
                return knowledge.saude.quedas;
            }
            if (q.includes('receber remédios')) {
                return knowledge.saude.receberRemedio;
            }
            if (q.includes('câncer') && q.includes('colo')) {
                return knowledge.saude.cancerColo;
            }
            if (q.includes('papanicolau')) {
                return knowledge.saude.papanicolau;
            }
            if (q.includes('depressão')) {
                return knowledge.saude.depressao;
            }
            if (q.includes('emergências') && q.includes('usf')) {
                return knowledge.saude.emergencias;
            }
            
            // Perguntas sobre SISREG
            if (q.includes('sisreg') && (q.includes('o que é') || q.includes('sistema'))) {
                return knowledge.sisreg.definicao;
            }
            if (q.includes('módulos') && q.includes('sisreg')) {
                return knowledge.sisreg.modulos;
            }
            if (q.includes('serve') && q.includes('sisreg')) {
                return knowledge.sisreg.funcao;
            }
            if (q.includes('quem pode utilizar') && q.includes('sisreg')) {
                return knowledge.sisreg.usuarios;
            }
            if (q.includes('obrigatório') && q.includes('sisreg')) {
                return knowledge.sisreg.obrigatoriedade;
            }
            if (q.includes('sisreg') && (q.includes('como funciona') || q.includes('utilização'))) {
                return knowledge.sisreg.funcao;
            }
            
            // Autoridades e administração
            if (q.includes('diretor') && (q.includes('terceiro distrito') || q.includes('3º distrito'))) {
                return knowledge.equipeEspecifica.bruno;
            }
            
            if (q.includes('bruno de luna') || q.includes('bruno')) {
                return knowledge.equipeEspecifica.bruno;
            }
            
            if (q.includes('prefeito') || (q.includes('prefeito') && q.includes('recife'))) {
                return knowledge.equipeEspecifica.joao;
            }
            
            if (q.includes('joão campos') || q.includes('joao campos')) {
                return knowledge.equipeEspecifica.joao;
            }
            
            // Médicos residentes
            if (q.includes('médicos residentes') || q.includes('residentes') || q.includes('médico residente')) {
                return knowledge.equipeEspecifica.residentes;
            }
            
            if (q.includes('sabrina') || q.includes('dra sabrina') || q.includes('doutora sabrina')) {
                return "Dra. Sabrina é uma das médicas residentes da USF Apipucos.";
            }
            
            if (q.includes('felipe') && (q.includes('residente') || q.includes('dr felipe residente'))) {
                return "Dr. Felipe é um dos médicos residentes da USF Apipucos.";
            }
            
            // Endereço
            if (q.includes('endereço') || q.includes('onde fica') || q.includes('localização') || q.includes('local')) {
                return `A USF Apipucos fica no endereço: ${knowledge.endereco}`;
            }
            
            // Telefone
            if (q.includes('telefone') || q.includes('contato') || q.includes('ligar')) {
                return `Você pode entrar em contato conosco pelo telefone ${knowledge.telefone}`;
            }
            
            // Horário de funcionamento
            if (q.includes('horário') || q.includes('hora') || q.includes('funcionamento') || q.includes('abre') || q.includes('fecha')) {
                return `Nosso horário de funcionamento é: ${knowledge.horario}`;
            }
            
            // Serviços
            if (q.includes('serviços') || q.includes('serviço') || q.includes('atende') || q.includes('oferece') || q.includes('faz')) {
                return `Oferecemos os seguintes serviços: ${knowledge.servicos.join(', ')}.`;
            }
            
            // Médicos
            if (q.includes('médico') || q.includes('doutor') || q.includes('clínico') || q.includes('pediatra')) {
                if (q.includes('primeiro turno') || q.includes('manhã')) {
                    return `Médicos do primeiro turno (manhã): ${knowledge.medicos.primeiro}`;
                } else if (q.includes('segundo turno') || q.includes('tarde')) {
                    return `Médicos do segundo turno (tarde): ${knowledge.medicos.segundo}`;
                } else {
                    return `Nossos médicos trabalham em dois turnos: Manhã: ${knowledge.medicos.primeiro}. Tarde: ${knowledge.medicos.segundo}`;
                }
            }
            
            // Equipes por dia da semana
            if (q.includes('segunda') || q.includes('segunda-feira')) {
                return `Equipe de segunda-feira: ${knowledge.equipes.segunda}`;
            }
            if (q.includes('terça') || q.includes('terça-feira')) {
                return `Equipe de terça-feira: ${knowledge.equipes.terca}`;
            }
            if (q.includes('quarta') || q.includes('quarta-feira')) {
                return `Equipe de quarta-feira: ${knowledge.equipes.quarta}`;
            }
            if (q.includes('quinta') || q.includes('quinta-feira')) {
                return `Equipe de quinta-feira: ${knowledge.equipes.quinta}`;
            }
            if (q.includes('sexta') || q.includes('sexta-feira')) {
                return `Equipe de sexta-feira: ${knowledge.equipes.sexta}`;
            }
            
            // Exames
            if (q.includes('exame') || q.includes('coleta') || q.includes('sangue') || q.includes('urina')) {
                return `Realizamos exames ${knowledge.exames.horario}. Tipos de exames: ${knowledge.exames.tipos.join(', ')}. Documentos necessários: ${knowledge.exames.documentos}.`;
            }
            
            // Vacinação
            if (q.includes('vacina') || q.includes('vacinação') || q.includes('imunização')) {
                return `Vacinação acontece ${knowledge.vacinacao.dias}. Vacinas disponíveis: ${knowledge.vacinacao.tipos.join(', ')}. Traga: ${knowledge.vacinacao.documentos}.`;
            }
            
            // Agendamento
            if (q.includes('agendar') || q.includes('agendamento') || q.includes('marcar') || q.includes('consulta')) {
                return `Para agendar: ${knowledge.agendamento.como}. Horário de agendamento: ${knowledge.agendamento.horario}. Documentos necessários: ${knowledge.agendamento.documentos}. Chegue com ${knowledge.agendamento.chegada}.`;
            }
            
            // Email
            if (q.includes('email') || q.includes('e-mail')) {
                return `Nosso email é: ${knowledge.email}`;
            }
            
            // Resposta padrão
            return "Desculpe, não entendi sua pergunta. Você pode perguntar sobre horários, serviços, endereço, telefone, médicos, agendamentos, exames ou vacinação. Como posso ajudá-lo?";
        }

        // Função para adicionar mensagem ao chat
        function addMessage(sender, text, type) {
            const messages = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            messageDiv.innerHTML = `
                <div class="message-sender">${sender}</div>
                <div class="message-content">${text}</div>
            `;
            
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        // Função para falar texto com voz feminina otimizada
        function speak(text) {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'pt-BR';
            
            // Configurações para voz feminina mais natural
            utterance.rate = 0.85;  // Velocidade um pouco mais lenta para clareza
            utterance.pitch = 1.3;  // Tom mais agudo (feminino)
            utterance.volume = 0.9; // Volume ligeiramente reduzido para suavidade
            
            // Tenta selecionar uma voz feminina em português
            const voices = speechSynthesis.getVoices();
            const femaleVoice = voices.find(voice => 
                voice.lang.includes('pt') && 
                (voice.name.toLowerCase().includes('female') || 
                 voice.name.toLowerCase().includes('feminina') ||
                 voice.name.toLowerCase().includes('woman') ||
                 voice.name.toLowerCase().includes('maria') ||
                 voice.name.toLowerCase().includes('ana') ||
                 voice.name.toLowerCase().includes('lucia'))
            );
            
            // Se não encontrar voz feminina específica, usa a primeira voz portuguesa disponível
            const portugueseVoice = voices.find(voice => 
                voice.lang.includes('pt-BR') || voice.lang.includes('pt')
            );
            
            if (femaleVoice) {
                utterance.voice = femaleVoice;
            } else if (portugueseVoice) {
                utterance.voice = portugueseVoice;
            }
            
            speechSynthesis.speak(utterance);
            currentUtterance = utterance;
        }

        // Função para enviar mensagem
        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Adiciona mensagem do usuário
            addMessage('Você', message, 'user');
            input.value = '';
            
            // Mostra indicador de digitação
            showTypingIndicator();
            
            // Processa resposta após um pequeno delay
            setTimeout(() => {
                hideTypingIndicator();
                const response = processQuestion(message);
                addMessage('Flor', response, 'bot');
                speak(response);
            }, 1000);
        }

        // Função para lidar com teclas pressionadas
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Função para fazer pergunta rápida
        function askQuestion(question) {
            document.getElementById('userInput').value = question;
            sendMessage();
        }

        // Função para alternar reconhecimento de voz
        function toggleVoiceRecognition() {
            if (!recognition) {
                alert('Reconhecimento de voz não suportado neste navegador.');
                return;
            }
            
            if (isListening) {
                recognition.stop();
                continuousListening = false;
                updateVoiceButton(false);
                updateStatus('online', 'Online');
            } else {
                recognition.start();
                continuousListening = true;
                updateVoiceButton(true);
            }
        }

        // Função para atualizar botão de voz
        function updateVoiceButton(listening) {
            const btn = document.getElementById('voiceBtn');
            const icon = document.getElementById('voiceIcon');
            const text = document.getElementById('voiceText');
            
            if (listening) {
                btn.classList.add('listening');
                icon.textContent = '⏹️';
                text.textContent = 'Parar';
                isListening = true;
            } else {
                btn.classList.remove('listening');
                icon.textContent = '🎤';
                text.textContent = 'Ativar Voz';
                isListening = false;
            }
        }

        // Função para atualizar status
        function updateStatus(status, text) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            indicator.className = `status-indicator ${status}`;
            statusText.textContent = text;
        }

        // Função para mostrar indicador de digitação
        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
        }

        // Função para esconder indicador de digitação
        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        // Função para lidar com upload de logos
        function handleLogoUpload(input, placeholderId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const placeholder = document.getElementById(placeholderId);
                    placeholder.innerHTML = '<img src="' + e.target.result + '" alt="Logo">';
                    placeholder.classList.add('has-logo');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Função para carregar vozes quando estiverem disponíveis
        function loadVoices() {
            return new Promise((resolve) => {
                let voices = speechSynthesis.getVoices();
                if (voices.length > 0) {
                    resolve(voices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', () => {
                        voices = speechSynthesis.getVoices();
                        resolve(voices);
                    });
                }
            });
        }

        // Inicialização quando a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializa reconhecimento de voz
            initSpeechRecognition();
            
            // Carrega vozes e depois exibe mensagem de boas-vindas
            loadVoices().then(() => {
                setTimeout(() => {
                    const welcomeMessage = 'Bem-vindo à USF Apipucos! Eu sou a Flor, sua assistente virtual. Estou aqui para orientá-lo com carinho sobre nossos serviços de saúde. Como posso ajudá-lo hoje?';
                    addMessage('Flor', welcomeMessage, 'bot');
                    speak('Bem-vindo à USF Apipucos! Eu sou a Flor, sua assistente virtual. Como posso ajudá-lo hoje?');
                }, 1500);
            });
            
            // Foco no campo de input
            document.getElementById('userInput').focus();
        });
    </script>
</body>
</html>